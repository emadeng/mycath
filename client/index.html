<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8"/>
<title>دخول / إنشاء حساب</title>
<style>
  body { font-family: 'Segoe UI', sans-serif; background:#f4f6f8; display:flex; justify-content:center; align-items:center; height:100vh; }
  .box { background:#fff; padding:20px; border-radius:12px; box-shadow:0 4px 15px rgba(0,0,0,0.1); width:300px; }
  input, select, button { width:100%; margin:6px 0; padding:8px; border-radius:6px; border:1px solid #ccc; }
  button { cursor:pointer; background:#007bff; color:white; border:none; }
  button:hover { background:#0056b3; }
</style>
</head>
<body>
<div class="box">
  <h2>تسجيل الدخول</h2>
  <div id="login">
    <input id="username" placeholder="اسم المستخدم"/>
    <input id="password" type="password" placeholder="كلمة المرور"/>
    <button id="loginBtn">تسجيل الدخول</button>
    <p>ليس لديك حساب؟ <button id="signupBtn">إنشاء حساب</button></p>
  </div>

  <div id="signup" style="display:none;">
    <h2>إنشاء حساب جديد</h2>
    <input id="newUsername" placeholder="اسم المستخدم" />
    <input id="email" placeholder="البريد الإلكتروني" />
    <input id="newPassword" type="password" placeholder="كلمة المرور" />
    <select id="gender">
      <option value="male">ذكر</option>
      <option value="female">أنثى</option>
    </select>
    <input id="avatar" placeholder="رابط صورة الأفتار (اختياري)" />
    <button id="createAccountBtn">إنشاء الحساب</button>
    <button id="backToLoginBtn">رجوع</button>
  </div>
</div>

<script>
document.getElementById('signupBtn').onclick = () => {
  document.getElementById('login').style.display='none';
  document.getElementById('signup').style.display='block';
};
document.getElementById('backToLoginBtn').onclick = () => {
  document.getElementById('signup').style.display='none';
  document.getElementById('login').style.display='block';
};

// إنشاء حساب
document.getElementById('createAccountBtn').onclick = async () => {
  const username = document.getElementById('newUsername').value.trim();
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('newPassword').value.trim();
  const gender = document.getElementById('gender').value;
  const avatar = document.getElementById('avatar').value.trim();
  if (!username || !email || !password) return alert('أدخل جميع البيانات');

  const res = await fetch('/create-user', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({username,email,password,gender,avatar})
  });
  const data = await res.json();
  if (data.success) {
    alert('تم إنشاء الحساب! يمكنك تسجيل الدخول');
    document.getElementById('signup').style.display='none';
    document.getElementById('login').style.display='block';
  } else alert('اسم المستخدم أو البريد مستخدم مسبقًا');
};

// تسجيل الدخول
document.getElementById('loginBtn').onclick = async () => {
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();
  if(!username||!password)return alert('أدخل اسم المستخدم وكلمة المرور');

  try {
    const res = await fetch('/login',{
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({username,password})
    });
    const data = await res.json();
    if(!data.success) return alert('اسم المستخدم أو كلمة المرور غير صحيحة');

    // حفظ اسم المستخدم في sessionStorage
    sessionStorage.setItem('myUsername', data.user.username);

    // تحويل لصفحة الدردشة
    window.location.href = 'rooms.html';
  } catch(err){ console.error(err); alert('حدث خطأ'); }
};
</script>
</body>
</html>
