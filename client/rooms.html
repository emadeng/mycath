<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8">
<title>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØºØ±Ù</title>
<style>
body{ font-family:'Segoe UI',sans-serif; margin:0; background:#f4f6f8; }
.header{
  background: linear-gradient(135deg,#1976d2,#0d47a1);
  display: flex;
  color: #fff;
  padding: 12px 20px;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
}

.header h3{
  margin: 0;
}

/* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
.header .actions{
  display: flex;
  align-items: center;
  gap: 8px; /* Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
}

.header button{
  background: #ffffff33;
  border: none;
  color: #fff;
  padding: 6px 14px;
  border-radius: 20px;
  cursor: pointer;
  margin: 0;
}

.container{ max-width:900px; margin:20px auto; padding:10px; }
.room-card{ background:#fff; border-radius:12px; padding:14px; margin-bottom:12px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 4px 12px rgba(0,0,0,0.08); transition:0.3s; }
.room-card:hover{ transform:translateY(-2px); }
.room-info{ display:flex; align-items:center; gap:12px; }
.room-icon{ font-size:32px; }
.room-name{ font-size:18px; font-weight:bold; }
.room-meta{ font-size:12px; color:#666; }
.join-btn{ background:#1976d2; color:#fff; border:none; padding:6px 18px; border-radius:20px; cursor:pointer; }
.join-btn:hover{ background:#0d47a1; }
.locked{ color:#d32f2f; }
.open{ color:#2e7d32; }
.create-room{ background:#fff; padding:14px; border-radius:12px; display:flex; gap:10px; margin-bottom:15px; box-shadow:0 4px 12px rgba(0,0,0,.08); }
.create-room input{ flex:1; padding:8px 12px; border-radius:20px; border:1px solid #ccc; outline:none; }
.create-room button{ background:#1976d2; color:#fff; border:none; padding:8px 20px; border-radius:20px; cursor:pointer; }
</style>
</head>
<body>

<div class="header">
  <h3>ğŸ’¬<span id="user"></span></h3>
   <div class="actions">
  <button onclick="goLobby()">Lobby</button>
  <button onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
  </div>
</div>

<div class="create-room" id="createrooms">
  <input id="roomName" placeholder="Ø§Ø³Ù… Ø§Ù„ØºØ±ÙØ©">
  <input id="roomPass" placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
  <button onclick="createRoom()">â• Ø¥Ù†Ø´Ø§Ø¡</button>
</div>

<div class="container" id="roomsList">
  <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØºØ±Ù...</p>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const username=sessionStorage.getItem('myUsername');
document.getElementById('user').innerHTML= username + " Ø§Ù‡Ù„Ø§ Ùˆ Ø³Ù‡Ù„Ø§ Ø¨Ùƒ ";
if(!username) location.href='login.html';

const socket=io('/',{ auth:{ username } });
const roomsList=document.getElementById('roomsList');

socket.emit('get_rooms');

socket.on('rooms_list', rooms=>{
  roomsList.innerHTML='';
    if(rooms.length===0){ roomsList.innerHTML='<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØºØ±Ù Ø­Ø§Ù„ÙŠØ§Ù‹</p>'; return; }
  rooms.forEach(room=>{
	    if(room.owner===username){ document.getElementById('createrooms').style.display ='none'; }

    const card=document.createElement('div');
    card.className='room-card';
    card.innerHTML=`
      <div class="room-info">
        <div class="room-icon">ğŸ§</div>
        <div>
          <div class="room-name">${room.name}${room.locked?'ğŸ”’':''}</div>
          <div class="room-meta">ğŸ‘¥ ${room.count} | ğŸ‘‘ ${room.owner} | <span class="${room.locked?'locked':'open'}">${room.locked?'Ù…Ù‚ÙÙ„Ø©':'Ù…ÙØªÙˆØ­Ø©'}</span></div>
        </div>
      </div>
      <button class="join-btn">Ø¯Ø®ÙˆÙ„</button>
    `;
   card.querySelector('.join-btn').onclick = () => {
 let password = null;
 if(room.locked){
   password = prompt('ğŸ”’ Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„ØºØ±ÙØ©');
   if(password === null) return; // Ø¥Ù„ØºØ§Ø¡
 }
 sessionStorage.setItem('joinRoom', room.name);
 sessionStorage.setItem('roomPassword', password || '');
  
  // Ø£Ø±Ø³Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù…Ø¹ join_room
 socket.emit('join_room', { roomId: room.name, password: password });
// Ø§Ø³ØªÙ…Ø¹ Ù„Ù†Ø¬Ø§Ø­ Ø£Ùˆ Ø®Ø·Ø£ Ø§Ù„Ø¯Ø®ÙˆÙ„
  socket.once('room_joined', () => {
    location.href='room.html'; // ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø­
 });

  socket.once('error_msg', msg => {
    alert(msg); // Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
  });
    };
    roomsList.appendChild(card);
  });
});

function createRoom(){
  const name=document.getElementById('roomName').value.trim();
  const password=document.getElementById('roomPass').value.trim();
  if(!name){ alert('âŒ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ØºØ±ÙØ©'); return; }
  socket.emit('create_room',{ roomId:name, password: password||null });
  document.getElementById('roomName').value='';
  document.getElementById('roomPass').value='';
}

function goLobby(){ location.href='lobby.html'; }
function logout(){ location.href='logout.html'; }
</script>
</body>
</html>
